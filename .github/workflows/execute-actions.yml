name: Execute Actions

# This workflow executes pending actions from daily files after PRs are merged
# It runs on push to main branch when action files are modified

on:
  push:
    branches:
      - main
    paths:
      - 'actions/*.md'

# Ensure only one execution runs at a time to avoid conflicts
concurrency:
  group: execute-actions
  cancel-in-progress: false

jobs:
  execute:
    runs-on: ubuntu-latest
    name: Execute Pending Actions
    
    # Set permissions for the GitHub token to push commits
    permissions:
      contents: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # Use a token that can trigger workflows
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
      
      - name: Execute actions
        id: execution
        env:
          CI: "true"
          GITHUB_RUN_ID: ${{ github.run_id }}
          # Add any secrets needed by action scripts here
          # JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}
          # JIRA_URL: ${{ secrets.JIRA_URL }}
        run: |
          PYTHONPATH=. python tools/action_executor.py --file "actions/*.md" --commit
      
      - name: Execution summary
        if: always()
        run: |
          if [ "${{ steps.execution.outcome }}" == "success" ]; then
            echo "✅ All actions executed successfully"
          else
            echo "❌ Some actions failed - see logs above"
            exit 1
          fi
